<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline';">

    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <link rel="stylesheet" href="../Style.css">
</head>

<body>
    <img src="../Icon.png" width="96" height="96" alt="NoMoreScamTW Icon"
        style="border-radius: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">

    <div class="instructions" id="tutorialSection">
        <h2 id="title">歡迎使用 麥騙 <span style="font-size: 14px; color: #888; font-weight: normal;">v2.4.3</span></h2>

        <!-- Step 1 -->
        <p id="step1">1. 點擊按鈕，前往 <b>「App」</b> > <b>「Safari」</b> > <b>「延伸功能」</b></p>
        <button id="openSettingsBtn" style="
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin: 5px 0 15px 0;
            box-shadow: 0 2px 5px rgba(33, 150, 243, 0.3);
        ">前往設定</button>

        <!-- Step 2 -->
        <p id="step2">2. 請將 <b>「麥騙」</b> 開啟，並設定為 <b>「允許」</b></p>
        <div style="text-align: center; margin-bottom: 20px;">
            <img src="../Permission_1.png" class="instruction-img"
                style="max-width: 100%; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" alt="開啟麥騙">
            <img src="../Permission_2.png" class="instruction-img"
                style="max-width: 100%; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" alt="設定允許">
        </div>

        <!-- Step 3 (Hidden initially, shown after settings) -->
        <div id="step3Container"
            style="display: none; margin-top: 15px; border-top: 1px dashed #ddd; padding-top: 15px;">
            <p id="step3">3. 完成設定後，App 會顯示在 Safari 網址列中</p>

            <img src="../Instruction_iPhone.png" class="instruction-img img-iphone" alt="iPhone 示意圖">
            <img src="../Instruction_iPad.png" class="instruction-img img-ipad" alt="iPad 示意圖">

            <button id="testSafariBtn" onclick="window.webkit.messageHandlers.controller.postMessage('openSafari')"
                style="
                background: #4caf50;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 8px;
                font-size: 15px;
                font-weight: 600;
                cursor: pointer;
                width: 100%;
                margin-top: 15px;
                box-shadow: 0 2px 5px rgba(76, 175, 80, 0.3);
            ">開啟 Safari</button>
        </div>
    </div>

    <div id="footerSection">
        <p>需要更詳細的教學嗎？</p>
        <a href="https://support.apple.com/zh-tw/guide/iphone/iphab0432bf6/ios" target="_blank">
            查看 Apple 官方教學 ↗
        </a>
    </div>

    <script>
        let settingsClicked = false;

        document.getElementById('openSettingsBtn').addEventListener('click', function () {
            settingsClicked = true;
            try {
                if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.controller) {
                    window.webkit.messageHandlers.controller.postMessage("openSettings");
                }
            } catch (err) {
                console.error(err);
            }
        });

        // Called by Swift when app returns to foreground
        window.appDidResume = function () {
            if (settingsClicked) {
                document.getElementById('step3Container').style.display = 'block'; // Show Step 3 Container

                // Scroll to bottom smoothly
                setTimeout(() => {
                    document.getElementById('step3Container').scrollIntoView({ behavior: 'smooth' });
                }, 100);

                settingsClicked = false;
            }
        }
    </script>
</body>

</html>